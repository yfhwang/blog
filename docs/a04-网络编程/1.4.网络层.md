## 网络层

### IP数据包格式

![85c05fb1-5546-4c50-9221-21f231cdc8c5](../images/85c05fb1-5546-4c50-9221-21f231cdc8c5.jpg)

- 版本：4或6
- 首部长度、总长度（首部+数据部分）
- 生存时间：TTL。以路由器跳数为单位，当 TTL 为 0 时就丢弃数据报。
- 协议 ：指出携带的数据应该上交给哪个协议进行处理，例如 ICMP、TCP、UDP 等。
- 首部检验和 ：因为数据报每经过一个路由器，都要重新计算检验和，因此检验和不包含数据部分可以减少计算的工作量。

### IP地址分类

IP地址共32位，由两部分组成，网络号和主机号，其中不同分类具有不同的网络号长度，并且是固定的。

IP 地址 := `{< 网络号 >, < 主机号 >}`

![cbf50eb8-22b4-4528-a2e7-d187143d57f7](../images/cbf50eb8-22b4-4528-a2e7-d187143d57f7.png)

- A类地址：1个字节的网络号，3个字节的主机号，用于少量的大型网络；
- B类地址：2个字节的网络号，2个字节的主机号，用于中等规模的网络；
- C类地址：3个字节的网络号，1个字节的主机号，用于小规模的网络。

### 子网划分

通过在主机号字段中拿一部分作为子网号，把两级 IP 地址划分为三级 IP 地址。

IP 地址 ::= {< 网络号 >, < 子网号 >, < 主机号 >}

要使用子网，必须配置子网掩码。一个 B 类地址的默认子网掩码为 255.255.0.0，如果 B 类地址的子网占两个比特，那么子网掩码为 11111111 11111111 11000000 00000000，也就是 255.255.192.0。

注意，外部网络看不到子网的存在。

### ARP工作原理

网络层实现主机之间的通信，而链路层实现具体每段链路之间的通信。因此在通信过程中，IP 数据报的源IP地址和目的IP地址始终不变，而 MAC 地址随着链路的改变而改变。

![66192382-558b-4b05-a35d-ac4a2b1a9811](../images/66192382-558b-4b05-a35d-ac4a2b1a9811.jpg)

ARP 实现由 IP 地址得到 MAC 地址。

![b9d79a5a-e7af-499b-b989-f10483e71b8b](../images/b9d79a5a-e7af-499b-b989-f10483e71b8b.jpg)

每个主机都有一个 ARP 高速缓存，里面有本局域网上的各主机和路由器的 IP 地址到 MAC 地址的映射表。

如果A不知道B的MAC地址，则A通过广播发送ARP请求，B接收到后发送ARP响应给A。

![8006a450-6c2f-498c-a928-c927f758b1d0](../images/8006a450-6c2f-498c-a928-c927f758b1d0.png)



