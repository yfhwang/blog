## 进程与线程

### 二者区别

进程是资源分配的基本单位。

线程是CPU调度和分派的基本单位，是比进程更小的能独立运行的基本单位。

一个进程可以有多个线程，多个线程也可以并发执行

### 线程同步

- 同步互斥：互斥为多个时刻只有一个进程能使用资源；同步是一种更严格的互斥，进程有严格的先后执行关系。
- 信号量：它允许同一时刻多个线程访问同一资源，但是需要控制同一时刻访问此资源的最大线程数量。

```c
typedef int semaphore;
semaphore mutex = 1;
void P1() {
    down(&mutex);
    // 临界区
    up(&mutex);
}

void P2() {
    down(&mutex);
    // 临界区
    up(&mutex);
}
```

- 事件（信号）：通过通知操作的方式来保持多线程同步，还可以方便的实现多线程优先级的比较操作。

### 进程的通信方式

**管道**

- **管道**是一种半双工的通信方式，数据只能单项流动，并且只能在具有亲缘关系的进程间流动，进程的亲缘关系通常是父子进程
- **命名管道**也是半双工的通信方式，它允许无亲缘关系的进程间进行通信

**系统IPC**

- **消息队列**是消息的链表，存放在内核中并由消息队列标识符标识。
- **信号量**是一个计数器，用来控制多个进程对资源的访问，它通常作为一种锁机制。
- **共享内存**就是映射一段能被其它进程访问的内存，这段共享内存由一个进程创建，但是多个进程可以访问。
- **信号**是一种比较复杂的通信方式，用于通知接收进程某个事件已经发生。

**SOCKET**

- 套接字：可用于不同机器间的进程通信

### 进程的状态

![ProcessState](../images/ProcessState.png)

- 就绪状态：进程已获得除CPU以外的所需资源，等待分配CPU资源
- 运行状态：占用CPU资源运行，处于此状态的进程数小于等于CPU数
- 阻塞状态：缺少需要的资源从而由运行状态转换而来，但是该资源不包括 CPU 时间，缺少 CPU 时间会从运行态转换为就绪态。

### 进程调度算法

**批处理系统**

- FCFS(先来先服务)

- 短作业优先：非抢占式，长作业可能饿死

- 最短剩余时间优先

**交互式系统**

- 时间片轮转：将就绪进程按 FCFS 排成一个队列。队首运行一个时间片后，计时器时钟中断，使其停止执行，去往队尾。

- 优先级调度

  为了防止低优先级的进程永远等不到调度，可以随着时间的推移增加等待进程的优先级。

- 多级反馈队列：间片轮转调度算法和优先级调度算法的结合。设置了多个队列，每个队列时间片大小都不同，例如 1,2,4,8,..。进程在第一个队列没执行完，就会被移到下一个队列。

  ![042cf928-3c8e-4815-ae9c-f2780202c68f](../images/042cf928-3c8e-4815-ae9c-f2780202c68f.png)



**实时系统**

要求一个请求在一个确定时间内得到响应。



## 死锁

### 什么是死锁

在两个或者多个并发进程中，如果每个进程持有某种资源而又等待其它进程释放它或它们现在保持着的资源，在未改变这种状态之前都不能向前推进，称这一组进程产生了死锁。

![c037c901-7eae-4e31-a1e4-9d41329e5c3e](../images/c037c901-7eae-4e31-a1e4-9d41329e5c3e.png)

### 必要条件

- 互斥：一个资源一次只能被一个进程使用
- 占有和等待：一个进程因请求资源而阻塞时，对已获得资源保持不放
- 不可抢占：已经分配给一个进程的资源不能强制性地被抢占，它只能被占有它的进程显式地释放。
- 环路等待：若干进程之间形成一种头尾相接的环形等待资源关系

### 处理方法

主要有以下四种方法：

- 鸵鸟策略
- 死锁检测与死锁恢复
- 死锁预防
- 死锁避免

## 内存管理

### 缓冲区溢出

缓冲区溢出是指当计算机向缓冲区填充数据时，超出了缓冲区本身的容量，溢出的数据覆盖在合法数据上。

危害有以下两点：

- 程序崩溃
- 跳转并且执行一段恶意代码

造成缓冲区溢出的主要原因是程序中没有仔细检查用户输入。

### 分页和分段

- 段是信息的逻辑单位，对用户是可见的 ；页是信息的物理单位，对用户透明。
- 段的大小不固定，有它所完成的功能决定；页大大小固定，由系统决定
- 出现的原因：分页用于实现虚拟内存，从而获得更大的地址空间；分段主要是为了使程序和数据可以被划分为逻辑上独立的地址空间

## ref

- 路人甲：常见面试题整理--操作系统篇（每位开发者必备）https://zhuanlan.zhihu.com/p/23755202?refer=passer
- CS-Notes: [计算机操作系统](http://www.cyc2018.xyz/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%9F%BA%E7%A1%80/%E8%AE%A1%E7%AE%97%E6%9C%BA%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%20-%20%E7%9B%AE%E5%BD%95.html)

